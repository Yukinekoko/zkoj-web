<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="indi.snowmeow.zkoj.base.dao.PmsSolutionMapper">
    <cache/>
    <!-- 获取指定题目的评测总数 -->
    <select id="countSubmitFromProblemId" resultType="int">
        select count(id) as count
        from pms_solution
        where problem_id = #{problem_id}
    </select>
    <!-- 获取指定题目的AC评测总数 -->
    <select id="countAcceptedFromProblemId" resultType="int">
        select count(id) as accepted
        from pms_solution
        where problem_id = #{problem_id}
          and status_id = 1
    </select>

    <select id="getPreviewStatus" resultType="byte">
        select (case
                when min(status_id) = 1 then 1
                when min(status_id) > 1 then 2
                else 0 end) as status
        from pms_solution
        where user_id = #{user_id}
          and problem_id = #{problem_id}
        limit 1
    </select>

    <select id="getRankFromUserId" resultType="int">
        select rank_no
        from (select user_id, @rank:=@rank+1 as rank_no
              from (select distinct problem_id, status_id, user_id, count(id) as accepted
                    from pms_solution
                    where status_id = 1
                    group by user_id
                    order by accepted desc) as p, (select @rank := 0) as r) as p
        where user_id = #{userId};
    </select>

</mapper>